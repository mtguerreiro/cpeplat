
<Tabs>:
    font_name: 'Sans Serif'
    size_hint: 1, 1
    do_default_tab: False
    Start:
        id: start_tab
    Buck:
        id:buck_tab
    AnalysisTab:    
        id:al_tab

<Start@TabbedPanelItem> 
    text:'Start'
    port_select: port_select
    port_name: ''
    
    FloatLayout:
        size_hint:(1,1)
        
        Image:
            size_hint:(0.8,0.5)
            pos_hint:{'y':0.2,'left':0.05}
            source: 'sbuck-lm.png'
            allow_stretch: True

        BoxLayout:
            orientation:'horizontal'
            size_hint:(1.0,0.16)
           # size:(500,40) 
            pos_hint:{'y':0.82,'x':0.00}  
            canvas:
                Color:
                    rgba: 0.7,0.7,0.7,0.5
                Line:                
                    width:3
                    points: self.x+30,self.center_y,self.right-30,self.center_y  
            GridLayout:
                id: grid
                rows:2
                cols:4
                spacing:30

                Label:
                    id:select_com
                    text: 'Serial Port:'
                CommSelect:
                    id: port_select
                    #size_hint:(1,1)
                Button:
                    text:'Connect'
                Label:
                    id:status_conn
                    text:'Not Connected'
                Label:
                    id:select_com
                    text: 'Experiment:'
                Spinner:
                    text: 'Choose Experiment'
                    values:['Buck-Converter','Experiment2','Experiment3']


               




   

<DrawPlot@BoxLayout>    
    orientation: 'vertical'
    size_hint:(0.46,1)
    pos_hint: {'x':0.54,'y':0.0}
<AnalysisTab@TabbedPanelItem>
    text: 'Analysis'
    Analysis:
<Analysis@BoxLayout> 
    orientation: 'horizontal'
    ScrollView:

        size_hint: (1,1)
        pos_hint:{'x':0.0,'y':0.0}
        bar_width: 12
        bar_color: [0, 0, 255, 1]
        do_scroll_x: False
        do_scroll_y: True
        scroll_distance: 20
        scroll_type: ['bars']
        BoxLayout:
            size_hint: (0.95,0.95)
            orientation: 'horizontal'
            FloatLayout:
                size_hint: (0.5,1)
                id:form_layout
                b_sy: 0.05
                b_sx: 0.20
                b_px_off:0.0
                b_py_off:0.95
                fontsize: 16
                Button:
                    id: exp_btn
                    text: 'Export'
                    size_hint: self.parent.b_sx, self.parent.b_sy
                    pos_hint: {'x':self.parent.b_px_off, 'y': self.parent.b_py_off}
                    on_press: root.export_graph()
            #    Button:
             #       id: save_btn
              #      text: 'Save'
               #     size_hint: self.parent.b_sx, self.parent.b_sy
                #    pos_hint: {'x':self.parent.b_px_off+self.parent.b_sx, 'y': self.parent.b_py_off}
                Button:
                    id: add_btn
                    text: 'Add Src'
                    size_hint: self.parent.b_sx, self.parent.b_sy
                    pos_hint: {'x':self.parent.b_px_off+1*self.parent.b_sx, 'y':self.parent.b_py_off} 
                    on_press: root.add_source()
                Button:
                    id: rem_btn
                    text: 'Rem Src'
                    size_hint: self.parent.b_sx, self.parent.b_sy
                    pos_hint: {'x':self.parent.b_px_off+2*self.parent.b_sx, 'y':self.parent.b_py_off} 
                    on_press: root.remove_source()
                Button:
                    id: new_popup
                    text: 'New Analysis'
                    size_hint: self.parent.b_sx, self.parent.b_sy
                    pos_hint: {'x':self.parent.b_px_off+3*self.parent.b_sx, 'y':self.parent.b_py_off} 
                    on_press: root.open_popup() 
           #     Button:
            #        id: save_cfg
             #       text: 'Save Cfg'
              #      size_hint: self.parent.b_sx, self.parent.b_sy
               #     pos_hint: {'x':self.parent.b_px_off+5*self.parent.b_sx, 'y':self.parent.b_py_off}    
             #   Button:
              #      id: import_cfg
               #     text: 'Import Cfg'
                #    size_hint: self.parent.b_sx, self.parent.b_sy
                 #   pos_hint: {'x':self.parent.b_px_off+6*self.parent.b_sx, 'y':self.parent.b_py_off} 
              


            FloatLayout:
                title: title
                x_label: x_label
                y_label: y_label
                id:plot_layout 
                size_hint:(0.5,1.0)
                pos_hint:{'right':1,'y':0.0}        
                DrawPlot:
                    id:plot_al
                    size_hint:(1, 0.65)
                    pos_hint:{'y': 0.10, 'right':1}
                BoxLayout:
                    size_hint:(0.6, 0.10)
                    pos_hint:{'y': 0.80, 'right':1}
                    GridLayout:
                        id: grid
                        rows:3
                        cols:2
                        Label:
                            text:'Title:'
                            font_size:22
                            size_hint_x:None          
                            width: 100
                        TextInput
                            id: title
                            text: 'example_title'
                            size_hint_x:None
                            padding: [0, (self.height-self.line_height)/2]
                            font_size:22
                            multiline: False
                            width:400
                            on_text_validate: root.title=(self.text)
                        Label:
                            text:'X Label:'
                            font_size:22
                            size_hint_x:None          
                            width: 100
                        TextInput
                            id: x_label
                            text: 'time'
                            size_hint_x:None
                            padding: [0, (self.height-self.line_height)/2]
                            font_size:22
                            multiline: False
                            width:400
                            on_text_validate: root.x_label=(self.text)
                        Label:
                            text:'Y Label:'
                            font_size:22
                            size_hint_x:None          
                            width: 100
                        TextInput
                            id: y_label
                            text: 'variables'
                            size_hint_x:None
                            padding: [0, (self.height-self.line_height)/2]
                            font_size:22
                            multiline: False
                            width:400
                            on_text_validate: root.y_label=(self.text)         
        

            
<Buck@TabbedPanelItem> 
    text: 'Buck-Converter'
    id: bk_tab  
    FloatLayout:
        size_hint:(1,1)
        pos_hint: {'x':0,'y':0}
        b_sy: 0.05
        b_sx: 0.08
        b_px_off:0.0
        b_py_off:0.95
        bk_tab: bk_tab
        Button:
            id: upl_btn
            text: 'Upload'
            size_hint: self.parent.b_sx, self.parent.b_sy
            pos_hint: {'x':self.parent.b_px_off, 'y': self.parent.b_py_off}
            on_press: root.update_values()
        Label:
            text: 'Limits'
            pos_hint:{'x':0.01,'y':0.82}
            size_hint_y: 0.15
            size_hint_x: 0.2
        Limits:         
            id: limits_bar    
            font_size:18
            pos_hint:{'x':0.03,'y':0.7}
            size_hint_y: 0.15
            size_hint_x: 0.5
            canvas:
                Color:
                    rgba: 0.7,0.7,0.7,0.5
                Line:                
                    width:3
                    points: self.x,self.top+15,self.right,self.top+15
                Line:
                    width:3
                    points: self.x,self.y-15,self.right,self.y-15
        Label:
            text:'Actual Values' 
            pos_hint:{'x':0.01,'y':0.52} 
            size_hint_y: 0.15
            size_hint_x: 0.2
      
        
        ActualValues:
            id: actual_bar
            font_size:18
            pos_hint:{'x':0.03,'y':0.4}
            size_hint_y: 0.15
            size_hint_x: 0.5
            canvas:
                Color:
                    rgba: 0.7,0.7,0.7,0.5
                Line:                
                    width:3
                    points: self.x,self.top+15,self.right,self.top+15
                Line:
                    width:3
                    points: self.x,self.y-15,self.right,self.y-15
        Label:
            text: 'Experiment'
            pos_hint:{'x':0.01,'y':0.19}
            size_hint_y: 0.15
            size_hint_x: 0.2
        Experiment:
            font_size:18
            id: exp_bar
            pos_hint:{'x':0.03,'y':0.07}
            size_hint_y: 0.15
            size_hint_x: 0.5
            canvas:
                Color:
                    rgba: 0.7,0.7,0.7,0.5
                Line:                
                    width:3
                    points: self.x,self.top+15,self.right,self.top+15
                Line:
                    width:3
                    points: self.x,self.y-15,self.right,self.y-15
        DrawPlot:
            id: plot_exp

            
<FileHeader@BoxLayout>
    id: FileHeader
    size_hint_y:0.03
    orientation: 'vertical'
    GridLayout:
        cols:4
        Label:
            id:src_n
            text:'Source:'
            font_size:22
            size_hint_x:None          
            width: 100
        TextInput
            id: get_file
            size_hint_x:None
            padding: [0, (self.height-self.line_height)/2]
            font_size:22
            multiline: False
            width:600
            on_text_validate: root.load_text_input()
        Button:
            text: 'Load'
            font_size: 16
            size_hint_x:None
            width:100
            on_press: root.open_popup()
        Button:
            text: 'Del'
            font_size: 16
            size_hint_x:None
            width:100
            on_press: root.remove()

    
             
        
    
<InputsHeader@BoxLayout>
    id:InputsHeader
    size_hint_y:0.025
    orientation:'vertical'
    GridLayout:
        cols:5
        spacing: 1
        Label:
            size_hint_x: None          
            width: 200
            font_size:18
            text:''
        Label:
            size_hint_x: None          
            width: 150
            font_size:18
            text:'Col Number'
        Label:
            text:'Label' 
            font_size:18
            size_hint_x: None          
            width: 150
        Label:
            text:'y_scale'
            font_size:18
            size_hint_x: None          
            width: 150
        Label:
            text:'Show'
            font_size:18
            size_hint_x: None          
            width: 150
            
<ChooseInputs@GridLayout>
    id:grid
    cols:5
    spacing: 1
    Label:
        size_hint_x: None          
        width: 200
        font_size:18
        text:''
    Label:
        id: col_num
        text:'0'
        font_size:18
        size_hint_x: None          
        width: 150
    TextInput:
        id:label_input
        multiline: False
        text:'' 
        padding: [0, (self.height-self.line_height)/2]
        font_size:22
        readonly: False  
        size_hint_x: None          
        width: 150
    TextInput:
        id:scale_input
        multiline: False
        text:'1' 
        padding: [0,(self.height-self.line_height)/2]
        font_size:22
        readonly: False  
        size_hint_x: None          
        width: 150
    CheckBox:
        size_hint_x: None          
        width: 150
        id:checkbox_show
        on_press: self.parent.parent.parent.parent.parent.parent.update_graphs()
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:                      
                pos:self.center_x-9, self.center_y-13
                size:24,24

<Limits@BoxLayout>
    orientation: 'vertical'
    GridLayout:
        rows: 2
        cols: 8
        spacing: 60
        Label:
            text:'V_in'
            size_hint_x: None  
            width: 50
        TextInput:
            id: v_in_lim
            multiline: False
            text:'0.0'
            size_hint_x: None  
            width: 80
        Label:
            text:'I_l'
            multiline: False
            size_hint_x: None 
            width: 50 
        TextInput:
            id: i_l_lim
            text:'0.0'
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:''
            multiline: False
            size_hint_x: None 
            width: 50 
        Label:
            text:''
            size_hint_x: None  
            width: 80
        Label: 
            text:''
            size_hint_x: None 
            width: 50 
        Label:
            text:''
            size_hint_x: None  
            width: 80
        Label: 
            text:'V_out'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: v_out_lim
            text:'0.0'
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:''
            size_hint_x: None 
            width: 50 
        Label:
            text:''
            size_hint_x: None  
            width: 80
        Label: 
            text:''
            size_hint_x: None 
            width: 50 
        Label:
            text:''
            size_hint_x: None  
            width: 80


<Experiment@BoxLayout>
    orientation: 'vertical'
    GridLayout:
        rows: 3
        cols: 4
        spacing_vertical:50
        spacing_horizontal:100
        Label:
            text:'Input'
        Label:
            text:'Output'
        Label:
            text:''
        Label:
            text:''
        ToggleButton:
            text:'ON'
         #   background_down:
          #  background_normal:
        ToggleButton:
            text:'ON'
         #   background_down:
          #  background_normal:
        Label:
            text:''
        Label:
            text:''
        Button:
            text: 'Start'
            on_press:root.parent.parent.parent.ids.buck_tab.update_plots()
        Button:
            text: 'Stop'
            on_press:
        Button:
            text: 'Export'
            on_press:self.parent.parent.parent.bk_tab.export_graph()
        Button:
            text: 'Save Data'
            on_press:self.parent.parent.parent.bk_tab.save_data()
            


<ActualValues@BoxLayout>
    orientation: 'vertical'
    GridLayout:
        rows: 2
        cols: 8
        spacing: 60
        Label:
            text:'V_in'
            size_hint_x: None  
            width: 50
        TextInput:
            id: v_in
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'Vout'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: v_out
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'I_l'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: i_l
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'PWM'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: pwm
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'V_in_buck'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: v_in_buck
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'V_out_buck'
            size_hint_x: None 
            width: 50 
        TextInput:
            id: v_out_buck
            text:''
            multiline: False
            size_hint_x: None  
            width: 80
        Label: 
            text:'I_l_AVG'
            size_hint_x: None 
            width: 50 
        TextInput:
            id:i_l_avg
            text:'0'
            multiline: False
            size_hint_x: None  
            width: 80



<AnalysisPopUp@Popup>
    auto_dismiss: False
    Analysis:  
        size_hint:(0.8,0.8)  
        Button:
            size_hint:(0.1,0.1)
            text: 'Close Analysis'
            on_release: root.dismiss()        
<MyFigure@BoxLayout>


<FileChoose@BoxLayout>
    orientation:'vertical'
               

            
<FileChoosePopup>:
    title: "Choose a .CSV File"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .25, 'center_y': .5}
            spacing: 20
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Load"
                on_release: root.load(filechooser.selection)
                id: ldbtn
                disabled: True if filechooser.selection==[] else False
